<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚µã‚¤ã‚¼ãƒªãƒ¤ãƒ¡ãƒ‹ãƒ¥ãƒ¼ææ¡ˆã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
            background: linear-gradient(135deg, #009246 0%, #ffffff 50%, #ce2b37 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #c8161d;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .option-group {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .option-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
            display: block;
            font-size: 16px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .option-button {
            flex: 1;
            min-width: 120px;
            padding: 12px 16px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .option-button:hover {
            border-color: #c8161d;
            transform: translateY(-2px);
        }

        .option-button.active {
            background: #c8161d;
            color: white;
            border-color: #c8161d;
        }

        .option-button-small {
            padding: 10px 14px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            font-weight: 500;
            margin: 4px;
        }

        .option-button-small:hover {
            border-color: #c8161d;
            transform: translateY(-2px);
        }

        .option-button-small.active {
            background: #c8161d;
            color: white;
            border-color: #c8161d;
        }

        .must-have-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: 'Hiragino Kaku Gothic ProN', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
        }

        .must-have-input:focus {
            outline: none;
            border-color: #c8161d;
        }

        .generate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #c8161d 0%, #e74c3c 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(200, 22, 29, 0.4);
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(200, 22, 29, 0.6);
        }

        .gacha-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
        }

        .gacha-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.6);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .confirm-btn {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
        }

        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.6);
        }

        .retry-btn {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.4);
        }

        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(149, 165, 166, 0.6);
        }

        .result {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            border-radius: 12px;
            border: 2px solid #c8161d;
            display: none;
        }

        .result.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-title {
            font-size: 20px;
            font-weight: bold;
            color: #c8161d;
            margin-bottom: 15px;
            text-align: center;
        }

        .menu-item {
            background: white;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .menu-item:last-child {
            margin-bottom: 0;
        }

        .menu-name {
            font-weight: bold;
            color: #333;
        }

        .menu-price {
            color: #c8161d;
            font-weight: bold;
            font-size: 16px;
        }

        .total {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #c8161d;
            text-align: right;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .total-amount {
            color: #c8161d;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ ã‚µã‚¤ã‚¼ãƒªãƒ¤ãƒ¡ãƒ‹ãƒ¥ãƒ¼ææ¡ˆ</h1>
        <p class="subtitle">ä»Šæ—¥ã®æ°—åˆ†ã«åˆã‚ã›ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ææ¡ˆã—ã¾ã™</p>

        <div class="option-group">
            <label class="option-label">äºˆç®—</label>
            <div class="button-group">
                <button class="option-button active" data-option="budget" data-value="800-1000">800ã€œ1,000å††</button>
                <button class="option-button" data-option="budget" data-value="1000-1200">1,000ã€œ1,200å††</button>
                <button class="option-button" data-option="budget" data-value="1200-1500">1,200ã€œ1,500å††</button>
                <button class="option-button" data-option="budget" data-value="custom">â—‹â—‹å††ä»¥å†…</button>
            </div>
            <input type="number" id="customBudget" class="must-have-input" placeholder="ä¾‹: 1500" style="margin-top: 10px; display: none;" min="500" max="3000">
        </div>

        <div class="option-group">
            <label class="option-label">ãƒ‰ãƒªãƒ³ã‚¯ãƒãƒ¼ï¼ˆã‚»ãƒƒãƒˆä¾¡æ ¼200å††ï¼‰</label>
            <div class="button-group">
                <button class="option-button active" data-option="drinkbar" data-value="yes">ã¤ã‘ã‚‹</button>
                <button class="option-button" data-option="drinkbar" data-value="no">ã¤ã‘ãªã„</button>
            </div>
        </div>

        <div class="option-group">
            <label class="option-label">æ°—åˆ†</label>
            <div class="button-group">
                <button class="option-button active" data-option="mood" data-value="standard">å®šç•ª</button>
                <button class="option-button" data-option="mood" data-value="challenge">ãƒãƒ£ãƒ¬ãƒ³ã‚¸</button>
                <button class="option-button" data-option="mood" data-value="expert">é€šå¥½ã¿</button>
            </div>
        </div>

        <div class="option-group">
            <label class="option-label">å¿…ãšå…¥ã‚ŒãŸã„ã‚¸ãƒ£ãƒ³ãƒ«ï¼ˆä»»æ„ï¼‰</label>
            <div class="button-group" style="flex-wrap: wrap;">
                <button class="option-button-small" data-category="pasta" onclick="toggleCategory('pasta')">ãƒ‘ã‚¹ã‚¿</button>
                <button class="option-button-small" data-category="pizza" onclick="toggleCategory('pizza')">ãƒ”ã‚¶</button>
                <button class="option-button-small" data-category="doria" onclick="toggleCategory('doria')">ãƒ‰ãƒªã‚¢ãƒ»ã‚°ãƒ©ã‚¿ãƒ³</button>
                <button class="option-button-small" data-category="hamburg" onclick="toggleCategory('hamburg')">ãƒãƒ³ãƒãƒ¼ã‚°</button>
                <button class="option-button-small" data-category="salad" onclick="toggleCategory('salad')">ã‚µãƒ©ãƒ€</button>
                <button class="option-button-small" data-category="appetizer" onclick="toggleCategory('appetizer')">å‰èœ</button>
                <button class="option-button-small" data-category="soup" onclick="toggleCategory('soup')">ã‚¹ãƒ¼ãƒ—</button>
                <button class="option-button-small" data-category="dessert" onclick="toggleCategory('dessert')">ãƒ‡ã‚¶ãƒ¼ãƒˆ</button>
            </div>
            <div style="font-size: 12px; color: #666; margin-top: 8px;">â€» è¤‡æ•°é¸æŠå¯èƒ½ã§ã™</div>
        </div>

        <button class="generate-btn" onclick="generateMenu()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ææ¡ˆã—ã¦ã‚‚ã‚‰ã†ï¼</button>
        
        <button class="gacha-btn" onclick="generateGacha()">ğŸ° ä»Šæ—¥ã®é‹è©¦ã—ï¼ã‚¬ãƒãƒ£ã§æ±ºã‚ã‚‹</button>

        <div class="result" id="result">
            <div class="result-title">ä»Šæ—¥ã®ãŠã™ã™ã‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
            <div id="menuList"></div>
            <div class="total">
                åˆè¨ˆ: <span class="total-amount" id="totalPrice">0å††</span>
            </div>
            <div class="action-buttons">
                <button class="action-btn confirm-btn" onclick="confirmOrder()">âœ… ã“ã‚Œã«ã™ã‚‹ï¼</button>
                <button class="action-btn retry-btn" onclick="retryMenu()">ğŸ”„ ã‚‚ã†ä¸€å›è€ƒãˆã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        // Order history storage
        let orderHistory = JSON.parse(localStorage.getItem('saizeriyaOrders') || '[]');
        let currentMenu = [];
        let selectedCategories = [];

        function toggleCategory(category) {
            const button = document.querySelector(`[data-category="${category}"]`);
            
            if (selectedCategories.includes(category)) {
                // Remove category
                selectedCategories = selectedCategories.filter(c => c !== category);
                button.classList.remove('active');
            } else {
                // Add category
                selectedCategories.push(category);
                button.classList.add('active');
            }
        }

        const menuData = {
            standard: {
                side: [
                    { name: 'è¾›å‘³ãƒã‚­ãƒ³', price: 300, calories: 390, seasonal: false, category: 'appetizer' },
                    { name: 'ãƒãƒƒãƒ—ã‚³ãƒ¼ãƒ³ã‚·ãƒ¥ãƒªãƒ³ãƒ—', price: 300, calories: 280, seasonal: false, category: 'appetizer' },
                    { name: 'ã‚­ãƒ£ãƒ­ãƒƒãƒˆãƒ©ãƒš', price: 200, calories: 80, seasonal: false, category: 'appetizer' },
                    { name: 'å°ã‚¨ãƒ“ã®ã‚«ã‚¯ãƒ†ãƒ«', price: 280, calories: 120, seasonal: false, category: 'appetizer' },
                    { name: 'è’¸ã—é¶ã®é¦™å‘³ã‚½ãƒ¼ã‚¹', price: 280, calories: 200, seasonal: false, category: 'appetizer' },
                    { name: 'ãƒãƒ¢ãƒ³ãƒ»ã‚»ãƒ©ãƒ¼ãƒ', price: 320, calories: 180, seasonal: false, category: 'appetizer' },
                    { name: 'ã‚¹ã‚¤ãƒ¼ãƒˆã‚³ãƒ¼ãƒ³', price: 200, calories: 150, seasonal: false, category: 'appetizer' },
                    { name: 'ã»ã†ã‚Œã‚“è‰ã®ã‚½ãƒ†ãƒ¼', price: 200, calories: 90, seasonal: false, category: 'appetizer' },
                    { name: 'ã‚«ãƒªã£ã¨ãƒãƒ†ãƒˆ', price: 280, calories: 320, seasonal: false, category: 'appetizer' },
                    { name: 'ãƒãƒ†ãƒˆã®ã‚°ãƒªãƒ«', price: 300, calories: 280, seasonal: false, category: 'appetizer' },
                    { name: 'ãƒãƒ§ãƒªã‚½ãƒ¼', price: 400, calories: 420, seasonal: false, category: 'appetizer' },
                    { name: 'å°ã‚¨ãƒ“ã®ã‚µãƒ©ãƒ€', price: 350, calories: 140, seasonal: false, category: 'salad' },
                    { name: 'ãƒã‚­ãƒ³ã®ã‚µãƒ©ãƒ€', price: 350, calories: 180, seasonal: false, category: 'salad' },
                    { name: 'ã‚ã‹ã‚ã®ã‚µãƒ©ãƒ€', price: 350, calories: 100, seasonal: false, category: 'salad' },
                    { name: 'æŸ”ã‚‰ã‹é’è±†ã®æ¸©ã‚µãƒ©ãƒ€', price: 200, calories: 110, seasonal: false, category: 'salad' },
                ],
                main: [
                    { name: 'ãƒŸãƒ©ãƒé¢¨ãƒ‰ãƒªã‚¢', price: 300, calories: 520, seasonal: false, category: 'doria' },
                    { name: 'åŠç†Ÿåµã®ãƒŸãƒ©ãƒé¢¨ãƒ‰ãƒªã‚¢', price: 350, calories: 600, seasonal: false, category: 'doria' },
                    { name: 'ç„¼ããƒãƒ¼ã‚ºãƒŸãƒ©ãƒé¢¨ãƒ‰ãƒªã‚¢', price: 350, calories: 610, seasonal: false, category: 'doria' },
                    { name: 'ã‚¿ãƒ©ã‚³ã‚½ãƒ¼ã‚¹ã‚·ã‚·ãƒªãƒ¼é¢¨', price: 400, calories: 530, seasonal: false, category: 'pasta' },
                    { name: 'ãƒšãƒšãƒ­ãƒ³ãƒãƒ¼ãƒ', price: 300, calories: 480, seasonal: false, category: 'pasta' },
                    { name: 'åŠç†Ÿåµã®ãƒšãƒšãƒ­ãƒ³ãƒãƒ¼ãƒ', price: 350, calories: 560, seasonal: false, category: 'pasta' },
                    { name: 'ã‚«ãƒ«ãƒœãƒŠãƒ¼ãƒ©', price: 500, calories: 720, seasonal: false, category: 'pasta' },
                    { name: 'ãƒŸãƒ¼ãƒˆã‚½ãƒ¼ã‚¹ãƒœãƒ­ãƒ‹ã‚¢é¢¨', price: 400, calories: 580, seasonal: false, category: 'pasta' },
                    { name: 'åŠç†Ÿåµã®ãƒŸãƒ¼ãƒˆã‚½ãƒ¼ã‚¹ãƒœãƒ­ãƒ‹ã‚¢é¢¨', price: 450, calories: 660, seasonal: false, category: 'pasta' },
                    { name: 'ãƒ‘ãƒ«ãƒé¢¨ã‚¹ãƒ‘ã‚²ãƒƒãƒ†ã‚£', price: 400, calories: 620, seasonal: false, category: 'pasta' },
                    { name: 'ãƒšãƒ³ãƒã‚¢ãƒ©ãƒ“ã‚¢ãƒ¼ã‚¿ï¼ˆå…¨ç²’ç²‰ï¼‰', price: 400, calories: 520, seasonal: false, category: 'pasta' },
                    { name: 'ãƒãƒƒãƒ•ã‚¡ãƒ­ãƒ¼ãƒ¢ãƒƒãƒ„ã‚¡ãƒ¬ãƒ©ã®ãƒãƒ«ã‚²ãƒªãƒ¼ã‚¿ãƒ”ã‚¶', price: 400, calories: 560, seasonal: false, category: 'pizza' },
                    { name: 'ã‚½ãƒ¼ã‚»ãƒ¼ã‚¸ãƒ”ã‚¶', price: 400, calories: 630, seasonal: false, category: 'pizza' },
                    { name: 'ãŸã£ã·ã‚Šã‚³ãƒ¼ãƒ³ã®ãƒ”ã‚¶', price: 400, calories: 580, seasonal: false, category: 'pizza' },
                    { name: 'é‡èœã¨ãã®ã“ã®ãƒ”ã‚¶', price: 400, calories: 520, seasonal: false, category: 'pizza' },
                    { name: 'ãƒãƒ³ãƒãƒ¼ã‚°ã‚¹ãƒ†ãƒ¼ã‚­ï¼ˆãƒ‡ãƒŸã‚½ãƒ¼ã‚¹ï¼‰', price: 400, calories: 450, seasonal: false, category: 'hamburg' },
                    { name: 'è‹¥é¶ã®ãƒ‡ã‚£ã‚¢ãƒœãƒ©é¢¨ï¼ˆã‚¬ãƒ«ãƒ ã‚½ãƒ¼ã‚¹ï¼‰', price: 500, calories: 540, seasonal: false, category: 'chicken' },
                    { name: 'æŸ”ã‚‰ã‹ãƒã‚­ãƒ³ã®ãƒãƒ¼ã‚ºç„¼ãï¼ˆãƒ‡ãƒŸã‚½ãƒ¼ã‚¹ï¼‰', price: 500, calories: 620, seasonal: false, category: 'chicken' },
                ],
                dessert: [
                    { name: 'ãƒ†ã‚£ãƒ©ãƒŸã‚¹ ã‚¯ãƒ©ã‚·ã‚³', price: 300, calories: 290, seasonal: false },
                    { name: 'ã‚¤ã‚¿ãƒªã‚¢ãƒ³ãƒ—ãƒªãƒ³', price: 250, calories: 210, seasonal: false },
                    { name: 'ãƒŸãƒ«ã‚¯ã‚¸ã‚§ãƒ©ãƒ¼ãƒˆ', price: 250, calories: 180, seasonal: false },
                    { name: 'ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‚±ãƒ¼ã‚­', price: 300, calories: 320, seasonal: false },
                    { name: 'ãƒˆãƒªãƒ•ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ', price: 350, calories: 270, seasonal: false },
                    { name: 'ã‚³ãƒ¼ãƒ’ãƒ¼ã‚¼ãƒªãƒ¼ï¼†ãƒŸãƒ«ã‚¯ã‚¸ã‚§ãƒ©ãƒ¼ãƒˆ', price: 350, calories: 200, seasonal: false },
                ]
            },
            challenge: {
                side: [
                    { name: 'ã‚¨ã‚¹ã‚«ãƒ«ã‚´ã®ã‚ªãƒ¼ãƒ–ãƒ³ç„¼ã', price: 400, calories: 250, seasonal: false, category: 'appetizer' },
                    { name: 'ã‚¢ãƒ­ã‚¹ãƒ†ã‚£ãƒãƒ¼ãƒ‹ï¼ˆãƒ©ãƒ ã®ä¸²ç„¼ãï¼‰', price: 400, calories: 380, seasonal: false, category: 'appetizer' },
                    { name: 'ãƒãƒƒãƒ•ã‚¡ãƒ­ãƒ¼ãƒ¢ãƒƒãƒ„ã‚¡ãƒ¬ãƒ©ã®ã‚«ãƒ—ãƒ¬ãƒ¼ã‚¼', price: 430, calories: 280, seasonal: false, category: 'appetizer' },
                    { name: 'ç”Ÿãƒãƒ ã¨ãƒãƒƒãƒ•ã‚¡ãƒ­ãƒ¼ãƒ¢ãƒƒãƒ„ã‚¢ãƒ¬ãƒ©ã®ç››åˆã‚ã›', price: 500, calories: 320, seasonal: false, category: 'appetizer' },
                    { name: 'ãƒ ãƒ¼ãƒ«è²ã®ã‚¬ãƒ¼ãƒªãƒƒã‚¯ç„¼ã', price: 400, calories: 190, seasonal: false, category: 'appetizer' },
                    { name: 'ãŸã¾ã­ãã®ã‚ºãƒƒãƒ‘', price: 300, calories: 180, seasonal: false, category: 'soup' },
                    { name: 'ã‚³ãƒ¼ãƒ³ã‚¯ãƒªãƒ¼ãƒ ã‚¹ãƒ¼ãƒ—', price: 150, calories: 130, seasonal: false, category: 'soup' },
                    { name: 'ç”°èˆé¢¨ãƒŸãƒã‚¹ãƒˆãƒ­ãƒ¼ãƒ', price: 300, calories: 150, seasonal: false, category: 'soup' },
                ],
                main: [
                    { name: 'ã‚¿ãƒ©ã‚³ã¨ãƒãƒƒãƒ—ã‚³ãƒ¼ãƒ³ã‚·ãƒ¥ãƒªãƒ³ãƒ—ã®ãƒ‰ãƒªã‚¢', price: 400, calories: 610, seasonal: false, category: 'doria' },
                    { name: 'ãƒãƒƒãƒ—ã‚³ãƒ¼ãƒ³ã‚·ãƒ¥ãƒªãƒ³ãƒ—ã¨ã‚¿ãƒ©ã‚³ã®ã‚¯ãƒªãƒ¼ãƒ ã‚°ãƒ©ã‚¿ãƒ³ï¼ˆå…¨ç²’ç²‰ï¼‰', price: 430, calories: 640, seasonal: false, category: 'doria' },
                    { name: 'ã‚¿ãƒ©ã‚³ã¨ã‚¨ãƒ“ã®ãƒ‰ãƒªã‚¢', price: 400, calories: 590, seasonal: false, category: 'doria' },
                    { name: 'ã‚¨ãƒ“ã¨ã‚¿ãƒ©ã‚³ã®ã‚¯ãƒªãƒ¼ãƒ ã‚°ãƒ©ã‚¿ãƒ³ï¼ˆå…¨ç²’ç²‰ï¼‰', price: 430, calories: 620, seasonal: false, category: 'doria' },
                    { name: 'å°ã‚¨ãƒ“ã®ã‚¿ãƒ©ã‚³ã‚½ãƒ¼ã‚¹', price: 540, calories: 680, seasonal: false, category: 'pasta' },
                    { name: 'ã‚¹ãƒ¼ãƒ—å…¥ã‚Šå¡©å‘³ãƒœãƒ³ã‚´ãƒ¬', price: 500, calories: 540, seasonal: false, category: 'pasta' },
                    { name: 'ã‚¤ã‚«ã®å¢¨å…¥ã‚Šã‚»ãƒ”ã‚¢ã‚½ãƒ¼ã‚¹', price: 500, calories: 560, seasonal: false, category: 'pasta' },
                    { name: 'ãã®ã“ã¨ã»ã†ã‚Œã‚“è‰ã®ã‚¯ãƒªãƒ¼ãƒ ã‚¹ãƒ‘ã‚²ãƒ†ã‚£', price: 600, calories: 720, seasonal: false, category: 'pasta' },
                    { name: 'ãƒ‡ã‚£ã‚¢ãƒœãƒ©é¢¨ãƒãƒ³ãƒãƒ¼ã‚°ï¼ˆã‚¬ãƒ«ãƒ ã‚½ãƒ¼ã‚¹ï¼‰', price: 500, calories: 520, seasonal: false, category: 'hamburg' },
                    { name: 'ã‚¤ã‚¿ãƒªã‚¢ãƒ³ãƒãƒ³ãƒãƒ¼ã‚°ï¼ˆãƒ‡ãƒŸã‚½ãƒ¼ã‚¹ï¼‰', price: 500, calories: 580, seasonal: false, category: 'hamburg' },
                    { name: 'ãƒŸãƒƒã‚¯ã‚¹ã‚°ãƒªãƒ«ï¼ˆãƒ‡ãƒŸã‚½ãƒ¼ã‚¹ï¼‰', price: 650, calories: 820, seasonal: false, category: 'hamburg' },
                    { name: 'ãƒ“ãƒ¼ãƒ•ã‚¹ãƒ†ãƒ¼ã‚­ï¼ˆã‚¬ãƒ«ãƒ ã‚½ãƒ¼ã‚¹ï¼‰', price: 1090, calories: 680, seasonal: false, category: 'hamburg' },
                    { name: 'ãƒ©ãƒ ï¼ˆä»”ç¾Šï¼‰ã¨é‡èœã®ã‚°ãƒªãƒ«', price: 870, calories: 650, seasonal: false, category: 'lamb' },
                ],
                dessert: [
                    { name: 'ãƒ—ãƒªãƒ³ã¨ãƒ†ã‚£ãƒ©ãƒŸã‚¹ ã‚¯ãƒ©ã‚·ã‚³ã®ç››åˆã›', price: 500, calories: 500, seasonal: false },
                    { name: 'ã‚¸ã‚§ãƒ©ãƒ¼ãƒˆï¼†ã‚·ãƒŠãƒ¢ãƒ³ãƒ•ã‚©ãƒƒã‚«ãƒã‚ª', price: 450, calories: 420, seasonal: false },
                ]
            },
            riceAndBread: [
                { name: 'ãƒ©ã‚¤ã‚¹', price: 150, calories: 270, category: 'rice' },
                { name: 'ã‚¹ãƒ¢ãƒ¼ãƒ«ãƒ©ã‚¤ã‚¹', price: 100, calories: 180, category: 'rice' },
                { name: 'ãƒ•ã‚©ãƒƒã‚«ãƒã‚ª', price: 150, calories: 220, category: 'bread' },
            ]
        };

        const options = {
            budget: '800-1000',
            drinkbar: 'yes',
            mood: 'standard'
        };

        document.querySelectorAll('.option-button').forEach(button => {
            button.addEventListener('click', function() {
                const option = this.dataset.option;
                const value = this.dataset.value;
                
                document.querySelectorAll(`[data-option="${option}"]`).forEach(btn => {
                    btn.classList.remove('active');
                });
                
                this.classList.add('active');
                options[option] = value;

                // Show/hide custom budget input
                if (option === 'budget') {
                    const customBudgetInput = document.getElementById('customBudget');
                    if (value === 'custom') {
                        customBudgetInput.style.display = 'block';
                    } else {
                        customBudgetInput.style.display = 'none';
                    }
                }
            });
        });

        function generateGacha() {
            // Gacha uses 1000-2000 budget, ignores all other settings
            const gachaBudget = Math.floor(Math.random() * 1000) + 1000; // 1000-2000å††
            const drinkbarPrice = Math.random() > 0.5 ? 200 : 0; // ãƒ©ãƒ³ãƒ€ãƒ ã§ãƒ‰ãƒªãƒ³ã‚¯ãƒãƒ¼
            let availableBudget = gachaBudget - drinkbarPrice;

            const allMenus = [
                ...menuData.standard.side,
                ...menuData.standard.main,
                ...menuData.standard.dessert,
                ...menuData.challenge.side,
                ...menuData.challenge.main,
                ...menuData.challenge.dessert,
            ];

            // Shuffle and pick random items
            const shuffled = allMenus.sort(() => 0.5 - Math.random());
            const gachaMenu = [];
            let total = 0;

            for (let item of shuffled) {
                if (total + item.price <= availableBudget && gachaMenu.length < 4) {
                    gachaMenu.push(item);
                    total += item.price;
                }
            }

            // Check if hamburg is in menu, add rice/bread
            const hasHamburg = gachaMenu.some(item => item.category === 'hamburg');
            if (hasHamburg && availableBudget - total >= 100) {
                const riceOrBread = menuData.riceAndBread[Math.floor(Math.random() * menuData.riceAndBread.length)];
                if (riceOrBread.price <= availableBudget - total) {
                    gachaMenu.push(riceOrBread);
                }
            }

            displayResult(gachaMenu, drinkbarPrice, true);
        }

        function retryMenu() {
            // Hide result and allow user to generate again
            document.getElementById('result').classList.remove('show');
        }

        function confirmOrder() {
            // Save order to history
            const order = {
                menu: currentMenu.map(item => item.name),
                date: new Date().toISOString(),
                total: currentMenu.reduce((sum, item) => sum + item.price, 0)
            };
            
            orderHistory.push(order);
            localStorage.setItem('saizeriyaOrders', JSON.stringify(orderHistory));

            // Update order count for each item
            currentMenu.forEach(item => {
                const itemName = item.name;
                const count = orderHistory.filter(order => order.menu.includes(itemName)).length;
                
                // If ordered 3+ times, consider adding to standard menu
                console.log(`${itemName}: ${count}å›æ³¨æ–‡`);
            });

            alert('æ³¨æ–‡ã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼ğŸ‰\næ¬¡å›ã®ææ¡ˆã«æ´»ã‹ã—ã¾ã™ã€‚');
            document.getElementById('result').classList.remove('show');
        }

        function generateMenu() {
            let minBudget, maxBudget;
            
            // Handle custom budget
            if (options.budget === 'custom') {
                const customValue = parseInt(document.getElementById('customBudget').value);
                if (!customValue || customValue < 500) {
                    alert('äºˆç®—ã‚’500å††ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                minBudget = customValue - 200;
                maxBudget = customValue;
            } else {
                [minBudget, maxBudget] = options.budget.split('-').map(Number);
            }
            
            const drinkbarPrice = options.drinkbar === 'yes' ? 200 : 0;
            let availableBudget = maxBudget - drinkbarPrice;

            // Get must-have items from selected categories
            const mustHaveItems = [];
            
            if (selectedCategories.length > 0) {
                const allMenus = [
                    ...Object.values(menuData.standard).flat(),
                    ...Object.values(menuData.challenge).flat(),
                ];
                
                selectedCategories.forEach(category => {
                    // Find one random item from this category
                    const categoryItems = allMenus.filter(item => item.category === category);
                    if (categoryItems.length > 0) {
                        const randomItem = categoryItems[Math.floor(Math.random() * categoryItems.length)];
                        if (!mustHaveItems.includes(randomItem)) {
                            mustHaveItems.push(randomItem);
                            availableBudget -= randomItem.price;
                        }
                    }
                });
            }

            let moodCategories = [];
            
            if (options.mood === 'expert') {
                // é€šå¥½ã¿ã¯ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸­å¿ƒã«ã€ãŸã¾ã«å®šç•ªã‚‚æ··ãœã‚‹
                moodCategories = ['challenge', 'standard'];
            } else {
                moodCategories = [options.mood];
            }

            // Collect all available items by category
            const availableItems = {
                side: [],
                main: [],
                dessert: []
            };

            moodCategories.forEach(mood => {
                availableItems.side.push(...menuData[mood].side);
                availableItems.main.push(...menuData[mood].main);
                availableItems.dessert.push(...menuData[mood].dessert);
            });

            // Remove must-have items from available items to avoid duplicates
            Object.keys(availableItems).forEach(category => {
                availableItems[category] = availableItems[category].filter(item => 
                    !mustHaveItems.some(mustHave => mustHave.name === item.name)
                );
            });

            // Shuffle each category
            Object.keys(availableItems).forEach(category => {
                availableItems[category].sort(() => 0.5 - Math.random());
            });

            // Check if must-have items contain hamburg
            const hasHamburg = mustHaveItems.some(item => item.category === 'hamburg');
            
            // Try different menu patterns with rules
            const patterns = [
                ['side', 'main', 'dessert'],
                ['side', 'side', 'main'],
                ['main', 'dessert'],
                ['side', 'main'],
            ];

            let bestMenu = null;
            let bestTotal = 0;

            patterns.forEach(pattern => {
                const menu = [];
                let total = 0;
                const selectedCategories = new Set();

                pattern.forEach(category => {
                    const item = availableItems[category].find(item => {
                        if (total + item.price > availableBudget) return false;
                        if (menu.includes(item)) return false;
                        
                        // Rule: Don't mix doria/gratin, hamburg, and pizza in main dishes
                        if (item.category) {
                            const heavyCategories = ['doria', 'hamburg', 'pizza'];
                            const itemIsHeavy = heavyCategories.includes(item.category);
                            
                            if (itemIsHeavy) {
                                // Check if we already have a heavy category
                                const hasHeavyCategory = Array.from(selectedCategories).some(cat => 
                                    heavyCategories.includes(cat)
                                );
                                if (hasHeavyCategory) return false;
                            }
                            
                            selectedCategories.add(item.category);
                        }
                        
                        return true;
                    });
                    
                    if (item) {
                        menu.push(item);
                        total += item.price;
                    }
                });

                // Prefer patterns that use more budget and have more variety
                if (menu.length === pattern.length && total > bestTotal) {
                    bestMenu = menu;
                    bestTotal = total;
                }
            });

            // Fallback: if no pattern worked, just pick items that fit budget
            if (!bestMenu || bestMenu.length === 0) {
                bestMenu = [];
                let total = 0;
                const selectedCategories = new Set();
                
                // Try main first
                const main = availableItems.main.find(item => {
                    if (item.price > availableBudget) return false;
                    const heavyCategories = ['doria', 'hamburg', 'pizza'];
                    if (item.category && heavyCategories.includes(item.category)) {
                        const hasHeavyCategory = Array.from(selectedCategories).some(cat => 
                            heavyCategories.includes(cat)
                        );
                        if (hasHeavyCategory) return false;
                        selectedCategories.add(item.category);
                    }
                    return true;
                });
                
                if (main) {
                    bestMenu.push(main);
                    total += main.price;
                }
                
                const side = availableItems.side.find(item => total + item.price <= availableBudget);
                if (side) {
                    bestMenu.push(side);
                    total += side.price;
                }
            }

            // Rule: If hamburg is selected, add rice or bread
            const finalMenuHasHamburg = bestMenu.some(item => item.category === 'hamburg') || hasHamburg;
            let riceOrBread = null;
            
            if (finalMenuHasHamburg && availableBudget >= 100) {
                // Try to add rice or bread
                const shuffledRiceAndBread = [...menuData.riceAndBread].sort(() => 0.5 - Math.random());
                riceOrBread = shuffledRiceAndBread.find(item => item.price <= availableBudget);
            }

            // Combine must-have items with generated menu
            let finalMenu = [...mustHaveItems, ...bestMenu];
            if (riceOrBread) {
                finalMenu.push(riceOrBread);
            }

            displayResult(finalMenu, drinkbarPrice);
        }

        function displayResult(menu, drinkbarPrice, isGacha = false) {
            const menuList = document.getElementById('menuList');
            const totalPrice = document.getElementById('totalPrice');
            const result = document.getElementById('result');
            const resultTitle = document.querySelector('.result-title');

            // Store current menu
            currentMenu = [...menu];

            let html = '';
            let total = 0;
            let totalCalories = 0;

            const categoryIcons = {
                side: 'ğŸ¥—',
                main: 'ğŸ',
                dessert: 'ğŸ°',
                rice: 'ğŸš',
                bread: 'ğŸ¥–'
            };

            menu.forEach(item => {
                // Determine category icon
                let icon = '';
                
                // Check if it's rice or bread
                if (item.category === 'rice' || item.category === 'bread') {
                    icon = categoryIcons[item.category];
                } else {
                    // Check in standard and challenge menus
                    for (let category in menuData.standard) {
                        if (menuData.standard[category].some(m => m.name === item.name) ||
                            menuData.challenge[category].some(m => m.name === item.name)) {
                            icon = categoryIcons[category] || '';
                            break;
                        }
                    }
                }

                const calorieInfo = item.calories ? ` (${item.calories}kcal)` : '';
                
                html += `
                    <div class="menu-item">
                        <span class="menu-name">${icon} ${item.name}<span style="font-size: 12px; color: #999;">${calorieInfo}</span></span>
                        <span class="menu-price">${item.price}å††</span>
                    </div>
                `;
                total += item.price;
                totalCalories += item.calories || 0;
            });

            if (drinkbarPrice > 0) {
                html += `
                    <div class="menu-item">
                        <span class="menu-name">ğŸ¥¤ ãƒ‰ãƒªãƒ³ã‚¯ãƒãƒ¼</span>
                        <span class="menu-price">${drinkbarPrice}å††</span>
                    </div>
                `;
                total += drinkbarPrice;
            }

            menuList.innerHTML = html;
            totalPrice.innerHTML = `${total}å†† <span style="font-size: 14px; color: #666;">(ç´„${totalCalories}kcal)</span>`;
            
            // Update title for gacha
            if (isGacha) {
                resultTitle.textContent = 'ğŸ° ã‚¬ãƒãƒ£çµæœï¼';
            } else {
                resultTitle.textContent = 'ä»Šæ—¥ã®ãŠã™ã™ã‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼';
            }
            
            result.classList.remove('show');
            setTimeout(() => result.classList.add('show'), 10);
        }
    </script>
</body>
</html>
